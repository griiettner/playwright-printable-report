# Playwright BDD Printable Report

This project wraps Playwright's native test runner with lightweight BDD helpers and a custom HTML reporter that is designed to produce a clean, printable audit report. The main pieces live in `src/resources/utils`:

- `bdd.ts` layers `Feature`, `Scenario`, `Given`, `When`, `Then`, `And`, and numbered `Step` helpers over the standard Playwright `test` API.
- `report-generator.ts` implements a Playwright reporter that converts the JSON report into a printer-friendly HTML summary located at `reports/bdd/index.html`.

## Prerequisites

- Node.js 18+ (Playwright requires modern LTS builds)
- npm 9+
- Chromium is downloaded automatically by Playwright during installation

Install dependencies after cloning:

```bash
npm install
```

## Writing BDD-Style Tests

Place step files in `src/steps`. Each file can declare one or more `Feature` blocks made available by the shared fixtures module (`src/fixtures/index.ts`). A minimal example:

```ts
import { Feature, Scenario, Given, Then, expect } from '../fixtures';

Feature('Search', ['smoke'], async (fx) => {
  await Scenario('User can search for Playwright', async () => {
    await Given('the user visits google.com', async () => {
      await fx.page.goto('https://www.google.com');
    });

    await Then('the logo is visible', async () => {
      await expect(fx.page.getByRole('img', { name: 'Google' })).toBeVisible();
    });
  });
});
```

Behind the scenes each helper maps to a Playwright `test.step`, so the nesting level is preserved in the report. Tags passed to `Feature` become test annotations, which surface in Playwright's JSON report and the printable report.

## Running Tests & Generating the Report

The default Playwright configuration in `playwright.config.ts` is already set up to:

- Run tests from `src/steps` (files ending with `.spec.ts` or `.steps.ts`)
- Emit Playwright's built-in line and HTML reporters
- Write a machine-readable JSON report to `reports/playwright.json`
- Invoke the custom reporter to transform that JSON into `reports/bdd/index.html`

To execute the suite and build the printable report:

```bash
npm test
```

On completion you'll see `BDD audit report generated at: reports/bdd/index.html` in the console. Open that file in any browser, expand/collapse scenarios, and print directly to PDF or paper. The page's print stylesheet keeps step details expanded and strips interactive UI so the export remains legible.

## Working with Reporter Outputs

- `reports/bdd/index.html` – dedicated printable report generated by `BddReporter`
- `reports/playwright/index.html` – standard Playwright HTML report
- `reports/playwright.json` – JSON source consumed by `BddReporter`
- `reports/results/` – traces, screenshots, and videos emitted per test run

These folders are ignored by git (`.gitignore`) so feel free to delete them between runs.

### Customizing the Output Location

The reporter path can be changed in `playwright.config.ts`:

```ts
['./src/resources/utils/report-generator.ts', { outputFile: 'reports/bdd/index.html' }]
```

Update the `outputFile` option to point to any writable path if you need to publish the report elsewhere.

## Tips for Extending

- Add reusable page actions inside `CommonPage` (`src/pages/common-page.ts`) and expose them through fixtures to keep steps expressive.
- Use the numbered `StepAction`/`StepExpect` helpers to group sequences when you need additional hierarchy inside a scenario.
- If you add new reporters or change the JSON file name, update both the Playwright config and the reporter so it reads the correct source file before rendering the HTML.

## Troubleshooting

- **Report not generated** – Ensure `reports/playwright.json` exists. Playwright only writes it when the JSON reporter is enabled (already configured). Delete stale `reports/` artifacts and re-run `npm test` if needed.
- **Missing assets in HTML report** – Traces, screenshots, and videos are stored separately in `reports/results/`. The printable HTML is intentionally self-contained and does not embed binaries. Include those artifacts manually if you need them in audit packages.

With these pieces in place you can capture BDD-style audit evidence quickly, share the HTML report internally, or export it to PDF for external stakeholders.
